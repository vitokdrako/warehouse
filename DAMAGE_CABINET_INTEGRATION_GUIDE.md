# üõ°Ô∏è –ö–∞–±—ñ–Ω–µ—Ç –®–∫–æ–¥–∏ - –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –æ–±—Ä–æ–±–∫–æ—é

## –©–æ –±—É–ª–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –î–∞–Ω–∏—Ö ‚úÖ

**–†–æ–∑—à–∏—Ä–µ–Ω–æ —Ç–∞–±–ª–∏—Ü—é `product_damage_history`:**
```sql
- processing_type: ENUM('none', 'wash', 'restoration', 'laundry')
- processing_status: ENUM('pending', 'in_progress', 'completed', 'failed')
- sent_to_processing_at: DATETIME
- returned_from_processing_at: DATETIME
- processing_notes: TEXT
- laundry_batch_id: VARCHAR(36) - –∑–≤'—è–∑–æ–∫ –∑ laundry_batches
- laundry_item_id: VARCHAR(36) - –∑–≤'—è–∑–æ–∫ –∑ laundry_items
```

### 2. Backend API ‚úÖ

**–ù–æ–≤—ñ endpoints –≤ `/api/product-damage-history`:**

#### –û–≥–ª—è–¥ —ñ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- `GET /dashboard/overview` - –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å—ñ—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- `GET /cases/grouped` - Damage cases –∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ –ø–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö

#### –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:
- `GET /cases/{order_id}/details` - –í—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

#### –ß–µ—Ä–≥–∏ –æ–±—Ä–æ–±–∫–∏:
- `GET /processing/wash` - –¢–æ–≤–∞—Ä–∏ –Ω–∞ –º–∏–π—Ü—ñ
- `GET /processing/restoration` - –¢–æ–≤–∞—Ä–∏ –≤ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—ó
- `GET /processing/laundry` - –¢–æ–≤–∞—Ä–∏ –≤ —Ö—ñ–º—á–∏—Å—Ç—Ü—ñ

#### –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤ –æ–±—Ä–æ–±–∫—É:
- `POST /{damage_id}/send-to-wash` - –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ –º–∏–π–∫—É
- `POST /{damage_id}/send-to-restoration` - –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—é
- `POST /{damage_id}/send-to-laundry` - –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ —Ö—ñ–º—á–∏—Å—Ç–∫—É (+ —Å—Ç–≤–æ—Ä—é—î laundry_batch/item)

#### –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏:
- `POST /{damage_id}/complete-processing` - –ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≥–æ—Ç–æ–≤–æ
- `POST /{damage_id}/mark-failed` - –ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –Ω–µ–≤–¥–∞–ª—É –æ–±—Ä–æ–±–∫—É

### 3. Frontend ‚úÖ

**–ù–æ–≤–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `DamageCabinet_New.tsx`** –∑ 4 –≤–∫–ª–∞–¥–∫–∞–º–∏:

#### üìã –ì–æ–ª–æ–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞
- –ü–æ–∫–∞–∑—É—î damage cases –∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ –ø–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö
- –ö–∞—Ä—Ç–∫–∞ case –º—ñ—Å—Ç–∏—Ç—å: –Ω–æ–º–µ—Ä –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–æ–≤–∞—Ä—ñ–≤, –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞, —Ç–∏–ø–∏ –æ–±—Ä–æ–±–∫–∏
- –ü—Ä–∏ –∫–ª—ñ–∫—É –Ω–∞ case ‚Üí –¥–µ—Ç–∞–ª—ñ –∑ –ø–µ—Ä–µ–ª—ñ–∫–æ–º –≤—Å—ñ—Ö —Ç–æ–≤–∞—Ä—ñ–≤
- –î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É –º–æ–∂–Ω–∞ –æ–±—Ä–∞—Ç–∏: üßº –ú–∏–π–∫–∞ / üî® –†–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—è / üß∫ –•—ñ–º—á–∏—Å—Ç–∫–∞

#### üßº –í–∫–ª–∞–¥–∫–∞ "–ú–∏–π–∫–∞"
- –í—Å—ñ —Ç–æ–≤–∞—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ –Ω–∞ –º–∏–π–∫—É
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –û—á—ñ–∫—É—é—Ç—å / –í –æ–±—Ä–æ–±—Ü—ñ / –ì–æ—Ç–æ–≤–æ / –ù–µ–≤–¥–∞–ª—ñ
- –ö–Ω–æ–ø–∫–∏: ‚úÖ –ì–æ—Ç–æ–≤–æ / ‚ùå –ù–µ–≤–¥–∞–ª–æ

#### üî® –í–∫–ª–∞–¥–∫–∞ "–†–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—è"
- –í—Å—ñ —Ç–æ–≤–∞—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω—ñ –≤ —Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—é
- –ê–Ω–∞–ª–æ–≥—ñ—á–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —è–∫ –ú–∏–π–∫–∞
- Tracking —Å—Ç–∞—Ç—É—Å—É –æ–±—Ä–æ–±–∫–∏

#### üß∫ –í–∫–ª–∞–¥–∫–∞ "–•—ñ–º—á–∏—Å—Ç–∫–∞"
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Laundry Cabinet
- –¢–æ–≤–∞—Ä–∏ –∑–≥—Ä—É–ø–æ–≤–∞–Ω—ñ –ø–æ –ø–∞—Ä—Ç—ñ—è—Ö (batches)
- –ü–æ–∫–∞–∑—É—î –∫–æ–º–ø–∞–Ω—ñ—é —Ö—ñ–º—á–∏—Å—Ç–∫–∏ —Ç–∞ —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—Ç—ñ—ó
- –ó–≤'—è–∑–æ–∫ –∑ laundry_batches —Ç–∞ laundry_items

---

## Workflow –û–±—Ä–æ–±–∫–∏ –ü–æ—à–∫–æ–¥–∂–µ–Ω–æ–≥–æ –¢–æ–≤–∞—Ä—É

### 1Ô∏è‚É£ –ü—Ä–∏–π–æ–º –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è–º–∏
```
–†–µ–∫–≤—ñ–∑–∏—Ç–æ—Ä –ø—Ä–∏–π–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
‚Üì
–§—ñ–∫—Å—É—î –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É
‚Üì
–î–ª—è –∫–æ–∂–Ω–æ—ó –ø–æ–∑–∏—Ü—ñ—ó –≤–∏–±–∏—Ä–∞—î:
  - üßº –ú–∏–π–∫–∞ (—è–∫—â–æ –±—Ä—É–¥–Ω–∏–π)
  - üî® –†–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—è (—è–∫—â–æ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π)
  - üß∫ –•—ñ–º—á–∏—Å—Ç–∫–∞ (—è–∫—â–æ —Ç–µ–∫—Å—Ç–∏–ª—å)
  - üí∞ –ü—Ä–æ—Å—Ç–æ —à—Ç—Ä–∞—Ñ (–±–µ–∑ –æ–±—Ä–æ–±–∫–∏)
‚Üì
–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è damage case
```

### 2Ô∏è‚É£ –û–±—Ä–æ–±–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤
```
–¢–æ–≤–∞—Ä –ø–æ—Ç—Ä–∞–ø–ª—è—î —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –≤–∫–ª–∞–¥–∫—É
‚Üì
–°—Ç–∞—Ç—É—Å: pending ‚Üí in_progress
‚Üì
–ü—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏:
  ‚úÖ completed (–ø–æ–≤–µ—Ä–Ω—É—Ç–æ –Ω–∞ —Å–∫–ª–∞–¥)
  ‚ùå failed (–Ω–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥—Ä–µ–º–æ–Ω—Ç—É–≤–∞—Ç–∏/–≤—ñ–¥—á–∏—Å—Ç–∏—Ç–∏)
```

### 3Ô∏è‚É£ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ —Ö—ñ–º—á–∏—Å—Ç–∫–æ—é
```
–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –≤ —Ö—ñ–º—á–∏—Å—Ç–∫—É
‚Üì
–°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è laundry_batch (–ø–∞—Ä—Ç—ñ—è)
‚Üì
–î–æ–¥–∞—î—Ç—å—Å—è laundry_item (—Ç–æ–≤–∞—Ä –≤ –ø–∞—Ä—Ç—ñ—ó)
‚Üì
–ó–≤'—è–∑–æ–∫: damage_history ‚Üî laundry_items ‚Üî laundry_batches
‚Üì
Tracking —á–µ—Ä–µ–∑ –æ–±–∏–¥–≤–∞ –∫–∞–±—ñ–Ω–µ—Ç–∏
```

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –ë–∞–∑–æ–≤–∏–π —Ç–µ—Å—Ç workflow:

**1. –°—Ç–≤–æ—Ä–∏—Ç–∏ damage record –∑ –æ–±—Ä–æ–±–∫–æ—é:**
```bash
curl -X POST http://localhost:8001/api/product-damage-history/ \
  -H "Content-Type: application/json" \
  -d '{
    "product_id": 1,
    "sku": "TEST-001",
    "product_name": "–¢–µ—Å—Ç–æ–≤–∏–π —Ç–æ–≤–∞—Ä",
    "category": "–¢–µ–∫—Å—Ç–∏–ª—å",
    "order_id": 123,
    "order_number": "ORD-123",
    "stage": "return",
    "damage_type": "–ü–ª—è–º–∏",
    "severity": "medium",
    "fee": 500,
    "note": "–¢–µ—Å—Ç –æ–±—Ä–æ–±–∫–∏",
    "processing_type": "laundry"
  }'
```

**2. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ damage cases:**
```bash
curl http://localhost:8001/api/product-damage-history/cases/grouped
```

**3. –î–µ—Ç–∞–ª—ñ –ø–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—é:**
```bash
curl http://localhost:8001/api/product-damage-history/cases/123/details
```

**4. –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤ —Ö—ñ–º—á–∏—Å—Ç–∫—É:**
```bash
curl -X POST http://localhost:8001/api/product-damage-history/{damage_id}/send-to-laundry \
  -H "Content-Type: application/json" \
  -d '{
    "laundry_company": "–•—ñ–º—á–∏—Å—Ç–∫–∞ –¢–µ—Å—Ç",
    "expected_return_date": "2025-01-20",
    "notes": "–¢–µ—Ä–º—ñ–Ω–æ–≤–æ"
  }'
```

**5. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ö—ñ–º—á–∏—Å—Ç–∫—É:**
```bash
curl http://localhost:8001/api/product-damage-history/processing/laundry
```

**6. –ó–∞–≤–µ—Ä—à–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É:**
```bash
curl -X POST http://localhost:8001/api/product-damage-history/{damage_id}/complete-processing \
  -H "Content-Type: application/json" \
  -d '{
    "notes": "–í—ñ–¥—á–∏—â–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ"
  }'
```

---

## Frontend –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. **–ü–µ—Ä–µ–π—Ç–∏ –≤ –ö–∞–±—ñ–Ω–µ—Ç –®–∫–æ–¥–∏:** `/damages`
2. **–ì–æ–ª–æ–≤–Ω–∞ –≤–∫–ª–∞–¥–∫–∞:** –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ damage cases
3. **–ö–ª—ñ–∫–Ω—É—Ç–∏ –Ω–∞ case:** –ü–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –∑ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
4. **–í–∏–±—Ä–∞—Ç–∏ —Ç–æ–≤–∞—Ä:** –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ –º–∏–π–∫—É/—Ä–µ—Å—Ç–∞–≤—Ä–∞—Ü—ñ—é/—Ö—ñ–º—á–∏—Å—Ç–∫—É
5. **–ü–µ—Ä–µ–π—Ç–∏ —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –≤–∫–ª–∞–¥–∫—É:** –ü–æ–±–∞—á–∏—Ç–∏ —Ç–æ–≤–∞—Ä –≤ —á–µ—Ä–∑—ñ
6. **–ü–æ–∑–Ω–∞—á–∏—Ç–∏ —è–∫ –≥–æ—Ç–æ–≤–æ:** –¢–æ–≤–∞—Ä –∑–Ω–∏–∫–∞—î –∑ —á–µ—Ä–≥–∏

---

## –í–∞–∂–ª–∏–≤—ñ –ü—Ä–∏–º—ñ—Ç–∫–∏

### üîó –ó–≤'—è–∑–æ–∫ –∑ Laundry Cabinet
- –ü—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –≤ —Ö—ñ–º—á–∏—Å—Ç–∫—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è batch —ñ item
- –¢–æ–≤–∞—Ä –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –≤ –æ–±–æ—Ö –º—ñ—Å—Ü—è—Ö: Damage Cabinet (–•—ñ–º—á–∏—Å—Ç–∫–∞) + Laundry Cabinet
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–µ —á–µ—Ä–µ–∑ `laundry_batch_id` —ñ `laundry_item_id`

### üí∞ –§—ñ–Ω–∞–Ω—Å–æ–≤–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è
- –í—Å—ñ damage records –º–∞—é—Ç—å `fee` (—Å—É–º–∞ —à–∫–æ–¥–∏)
- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –ø–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—é = —Å—É–º–∞ –≤—Å—ñ—Ö fees
- –ö–ª—ñ—î–Ω—Ç –ø–ª–∞—Ç–∏—Ç—å –æ–¥–Ω—É –∑–∞–≥–∞–ª—å–Ω—É —Å—É–º—É –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É –æ–±—Ä–æ–±–∫–∏
- –ó–≤'—è–∑–æ–∫ –∑ —Ñ—ñ–Ω–∞–Ω—Å–∞–º–∏: `order_id` ‚Üí FinanceCabinet

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- Dashboard –ø–æ–∫–∞–∑—É—î —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤
- –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –ø–æ —Ç–∏–ø–∞—Ö –æ–±—Ä–æ–±–∫–∏ —Ç–∞ —Å—Ç–∞—Ç—É—Å–∞—Ö
- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –∑–±–∏—Ç–∫—ñ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö

---

## –ú–æ–∂–ª–∏–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è (Future)

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∏–ø—É –æ–±—Ä–æ–±–∫–∏** –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó —Ç–æ–≤–∞—Ä—É
2. **–í–∞—Ä—Ç—ñ—Å—Ç—å –æ–±—Ä–æ–±–∫–∏** (–æ–∫—Ä–µ–º–æ –≤—ñ–¥ fee) –¥–ª—è —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Å–æ–±—ñ–≤–∞—Ä—Ç–æ—Å—Ç—ñ
3. **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏** (API —Ö—ñ–º—á–∏—Å—Ç–æ–∫, –º–∞–π—Å—Ç–µ—Ä–µ–Ω—å)
4. **Push notifications** –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Å—Ç–∞—Ç—É—Å—É
5. **–†–æ–∑—à–∏—Ä–µ–Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞** –ø–æ —Ç–∏–ø–∞—Ö –ø–æ—à–∫–æ–¥–∂–µ–Ω—å —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –æ–±—Ä–æ–±–∫–∏
6. **–ü–æ–≤—Ç–æ—Ä–Ω–∞ –æ–±—Ä–æ–±–∫–∞** —è–∫—â–æ failed ‚Üí –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–Ω–æ–≤—É

---

## –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ/—Å—Ç–≤–æ—Ä–µ–Ω–æ

### Backend:
- ‚úÖ `/app/backend/routes/product_damage_history.py` - –î–æ–¥–∞–Ω–æ –Ω–æ–≤—ñ endpoints

### Frontend:
- ‚úÖ `/app/frontend/src/pages/DamageCabinet_New.tsx` - –ù–æ–≤–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑ –≤–∫–ª–∞–¥–∫–∞–º–∏
- ‚úÖ `/app/frontend/src/App.tsx` - –û–Ω–æ–≤–ª–µ–Ω–æ import

### –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö:
- ‚úÖ `product_damage_history` - –î–æ–¥–∞–Ω–æ 7 –Ω–æ–≤–∏—Ö –∫–æ–ª–æ–Ω–æ–∫

---

**–ê–≤—Ç–æ—Ä:** E1 Agent  
**–î–∞—Ç–∞:** 10 –≥—Ä—É–¥–Ω—è 2024  
**–í–µ—Ä—Å—ñ—è:** 1.0
