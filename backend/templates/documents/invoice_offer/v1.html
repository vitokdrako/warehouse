{% extends '_base.html' %}
{% block title %}Рахунок-оферта {{ order.order_number }}{% endblock %}
{% block content %}
<div class="header">
    <div>
        <div class="logo">FarforRent</div>
        <div class="logo-sub">Оренда декору</div>
    </div>
    <div class="doc-info">
        <div class="doc-number">{{ doc_number }}</div>
        <div class="doc-date">від {{ generated_at }}</div>
    </div>
</div>

<h1>РАХУНОК-ОФЕРТА</h1>

<h2>Замовник</h2>
<table>
    <tr><td style="width:150px">ПІБ:</td><td class="font-bold">{{ order.customer_name }}</td></tr>
    <tr><td>Телефон:</td><td>{{ order.customer_phone }}</td></tr>
    <tr><td>Email:</td><td>{{ order.customer_email }}</td></tr>
</table>

<h2>Деталі оренди</h2>
<table>
    <tr><td style="width:150px">Номер замовлення:</td><td class="font-bold">{{ order.order_number }}</td></tr>
    <tr><td>Період оренди:</td><td>{{ order.rental_start_date }} — {{ order.rental_end_date }} ({{ order.rental_days }} дн.)</td></tr>
    <tr><td>Спосіб отримання:</td><td>{{ 'Самовивіз' if order.delivery_type == 'pickup' else 'Доставка: ' + order.delivery_address }}</td></tr>
</table>

<h2>Товари</h2>
<div class="table-wrap">
<table>
    <thead>
        <tr>
            <th style="width:30px">№</th>
            <th>Найменування</th>
            <th style="min-width:50px">SKU</th>
            <th style="min-width:40px">К-сть</th>
            <th style="min-width:70px">Ціна/день</th>
            <th style="min-width:80px">Оренда</th>
            <th style="min-width:80px">Застава</th>
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr>
            <td class="text-center">{{ loop.index }}</td>
            <td>{{ item.get('name', '') }}</td>
            <td>{{ item.get('sku', '') }}</td>
            <td class="text-center">{{ item.get('quantity') or item.get('qty', 1) }}</td>
            <td class="text-right">{{ "%.2f"|format(item.price_per_day) }}&nbsp;₴</td>
            <td class="text-right">{{ "%.2f"|format(item.total_rent) }}&nbsp;₴</td>
            <td class="text-right">{{ "%.2f"|format(item.total_deposit) }}&nbsp;₴</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<table class="totals">
    <tr><td style="width:70%"></td><td>Оренда:</td><td class="text-right">{{ totals.rent|money }} ₴</td></tr>
    <tr><td></td><td>Застава:</td><td class="text-right">{{ totals.deposit|money }} ₴</td></tr>
    {% if totals.discount > 0 %}<tr><td></td><td>Знижка:</td><td class="text-right">-{{ totals.discount|money }} ₴</td></tr>{% endif %}
    <tr class="total-row"><td></td><td>РАЗОМ ДО СПЛАТИ:</td><td class="text-right">{{ totals.grand_total|money }} ₴</td></tr>
</table>

<h2>Умови оплати</h2>
<ul style="font-size:9pt; padding-left:20px;">
    <li>Передоплата {{ company.prepayment_percent }}% вартості оренди</li>
    <li>Застава сплачується повністю до видачі товару</li>
    <li>Застава повертається після перевірки стану товару</li>
</ul>

<h2>Реквізити для оплати</h2>
<table>
    <tr><td style="width:150px">Отримувач:</td><td class="font-bold">{{ company.legal_name }}</td></tr>
    <tr><td>IBAN:</td><td>{{ company.iban }}</td></tr>
    <tr><td>ЄДРПОУ/ІПН:</td><td>{{ company.edrpou }}</td></tr>
    <tr><td>Призначення:</td><td>Оплата за оренду декору, замовлення {{ order.order_number }}</td></tr>
</table>

<div class="footer">
    <p>Цей рахунок є офертою. Оплата означає акцепт умов оренди.</p>
    <p class="company-details">{{ company.legal_name }} | {{ company.address }} | {{ company.phone }} | {{ company.email }}</p>
</div>
{% endblock %}