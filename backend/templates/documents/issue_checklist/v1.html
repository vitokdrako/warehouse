{% extends '_base.html' %}
{% block title %}–ß–µ–∫–ª–∏—Å—Ç –≤–∏–¥–∞—á—ñ {{ issue_card.order_number }}{% endblock %}
{% block extra_styles %}
<style>
    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
    .info-box { background: #f8f9fa; border-radius: 8px; padding: 12px; }
    .info-box .label { font-size: 9pt; color: #666; margin-bottom: 4px; }
    .info-box .value { font-weight: bold; font-size: 11pt; }
    .item-row { display: flex; align-items: center; padding: 10px 8px; border-bottom: 1px solid #eee; }
    .item-row:nth-child(odd) { background: #fafafa; }
    .item-check { width: 20px; height: 20px; border: 2px solid #28a745; border-radius: 4px; margin-right: 12px; display: flex; align-items: center; justify-content: center; color: #28a745; font-weight: bold; }
    .item-check.done { background: #d4edda; }
    .item-info { flex: 1; }
    .item-qty { background: #e3f2fd; padding: 4px 10px; border-radius: 4px; font-weight: bold; }
    .requisitors-box { background: #fff3e0; border: 1px solid #ffcc80; border-radius: 8px; padding: 12px; margin-bottom: 15px; }
    .requisitors-title { font-size: 10pt; color: #e65100; margin-bottom: 5px; }
    .requisitors-names { font-size: 12pt; font-weight: bold; }
    .notes-box { background: #e8f5e9; border-radius: 8px; padding: 12px; margin-top: 15px; }
</style>
{% endblock %}
{% block content %}
<div class="header">
    <div>
        <div class="logo">FarforRent</div>
        <div class="logo-sub">–í–ù–£–¢–†–Ü–®–ù–Ü–ô –î–û–ö–£–ú–ï–ù–¢</div>
    </div>
    <div class="doc-info">
        <div class="doc-number">{{ doc_number }}</div>
        <div class="doc-date">{{ generated_at }}</div>
    </div>
</div>

<h1>üìã –ß–ï–ö–õ–ò–°–¢ –í–ò–î–ê–ß–Ü</h1>

<div class="info-grid">
    <div class="info-box">
        <div class="label">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</div>
        <div class="value">{{ issue_card.order_number }}</div>
    </div>
    <div class="info-box">
        <div class="label">–ö–ª—ñ—î–Ω—Ç</div>
        <div class="value">{{ issue_card.customer_name }}</div>
    </div>
    <div class="info-box">
        <div class="label">–î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ</div>
        <div class="value">{{ issue_card.rental_start_date }}</div>
    </div>
    <div class="info-box">
        <div class="label">–î–∞—Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è</div>
        <div class="value">{{ issue_card.rental_end_date }}</div>
    </div>
</div>

{% if requisitors %}
<div class="requisitors-box">
    <div class="requisitors-title">üë∑ –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ –∑–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—é:</div>
    <div class="requisitors-names">
        {% for r in requisitors %}
            {{ r.name if r.name else r }}{% if not loop.last %}, {% endif %}
        {% endfor %}
    </div>
</div>
{% endif %}

<h2>‚úÖ –£–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω—ñ –ø–æ–∑–∏—Ü—ñ—ó</h2>
{% for item in items %}
<div class="item-row">
    <div class="item-check done">‚úì</div>
    <div class="item-info">
        <strong>{{ item.get('name', '') }}</strong>
        <div style="font-size:9pt;color:#666;">{{ item.get('sku') or item.get('article', '') }} | –õ–æ–∫–∞—Ü—ñ—è: {{ item.get('location', 'N/A') }}</div>
    </div>
    <div class="item-qty">{{ item.get('picked_qty') or item.get('quantity') or item.get('qty', 1) }} —à—Ç</div>
</div>
{% endfor %}

<div style="margin-top:15px; padding:10px; background:#e3f2fd; border-radius:8px; text-align:center;">
    <strong>–í—Å—å–æ–≥–æ –ø–æ–∑–∏—Ü—ñ–π:</strong> {{ items|length }} | 
    <strong>–í—Å—å–æ–≥–æ –æ–¥–∏–Ω–∏—Ü—å:</strong> {% set total = namespace(value=0) %}{% for item in items %}{% set total.value = total.value + (item.get('picked_qty') or item.get('quantity') or item.get('qty', 1)) %}{% endfor %}{{ total.value }}
</div>

{% if issue_card.preparation_notes %}
<div class="notes-box">
    <strong>üìù –ü—Ä–∏–º—ñ—Ç–∫–∏:</strong><br>
    {{ issue_card.preparation_notes }}
</div>
{% endif %}

<div class="signatures" style="margin-top:30px;">
    <div class="signature-block">
        <p>–ö–æ–º–ø–ª–µ–∫—Ç—É–≤–∞–ª—å–Ω–∏–∫:</p>
        <div class="signature-line"></div>
    </div>
    <div class="signature-block">
        <p>–ü–µ—Ä–µ–≤—ñ—Ä–∏–≤ / –í–∏–¥–∞–≤:</p>
        <div class="signature-line"></div>
    </div>
</div>
{% endblock %}