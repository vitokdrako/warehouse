# üìã Order Workflow - –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

## –°—Ç–∞—Ç—É—Å–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

```
pending ‚Üí awaiting_customer ‚Üí processing ‚Üí ready_for_issue ‚Üí issued ‚Üí on_rent ‚Üí returned/partial_return ‚Üí completed
                                                                           ‚Üì
                                                                      cancelled (–º–æ–∂–ª–∏–≤–æ –∑ –±—É–¥—å-—è–∫–æ–≥–æ —Å—Ç–∞—Ç—É—Å—É –¥–æ issued)
```

### –î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å —Å—Ç–∞—Ç—É—Å—ñ–≤:

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å | UI |
|--------|------|-----|
| `pending` | –ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–≤–Ω—É—Ç—Ä—ñ—à–Ω—î) | –ù–æ–≤–∏–π –æ—Ä–¥–µ—Ä |
| `awaiting_customer` | –û—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞ | –û—á—ñ–∫—É—î –∫–ª—ñ—î–Ω—Ç–∞ |
| `processing` | –ö–ª—ñ—î–Ω—Ç –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–≤, –≤ –æ–±—Ä–æ–±—Ü—ñ | –ù–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—ó |
| `ready_for_issue` | –°–∫–æ–º–ø–ª–µ–∫—Ç–æ–≤–∞–Ω–æ, –≥–æ—Ç–æ–≤–æ –¥–æ –≤–∏–¥–∞—á—ñ | –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–¥–∞—á—ñ |
| `issued` | –í–∏–¥–∞–Ω–æ –∫–ª—ñ—î–Ω—Ç—É | –í–∏–¥–∞–Ω–æ |
| `on_rent` | –í –æ—Ä–µ–Ω–¥—ñ (–∞–∫—Ç–∏–≤–Ω–∞ –æ—Ä–µ–Ω–¥–∞) | –í –æ—Ä–µ–Ω–¥—ñ |
| `partial_return` | –ß–∞—Å—Ç–∫–æ–≤–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è (—î —Ç–æ–≤–∞—Ä–∏ –≤ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—ñ) | –ß–∞—Å—Ç–∫–æ–≤–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è |
| `returned` | –ü–æ–≤–µ—Ä–Ω—É—Ç–æ –ø–æ–≤–Ω—ñ—Å—Ç—é | –ü–æ–≤–µ—Ä–Ω–µ–Ω–æ |
| `completed` | –ó–∞–≤–µ—Ä—à–µ–Ω–æ, –∞—Ä—Ö—ñ–≤–æ–≤–∞–Ω–µ | –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| `cancelled` | –°–∫–∞—Å–æ–≤–∞–Ω–æ | –°–∫–∞—Å–æ–≤–∞–Ω–æ |

---

## 1Ô∏è‚É£ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

**Endpoint:** `POST /api/orders`

**–ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å:** `awaiting_customer`

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–ø–∏—Å –≤ `orders`
- –ì–µ–Ω–µ—Ä—É—î—Ç—å—Å—è `order_number` (ORD-0001)
- –¢–æ–≤–∞—Ä–∏ —Ä–µ–∑–µ—Ä–≤—É—é—Ç—å—Å—è (—Ñ—ñ–∫—Å—É—é—Ç—å—Å—è –≤ `order_items`)
- –ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ `order_lifecycle`

---

## 2Ô∏è‚É£ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–æ–º

**Endpoint:** `POST /api/decor-orders/{id}/confirm-by-client`

**–ü–µ—Ä–µ—Ö—ñ–¥:** `awaiting_customer` ‚Üí `processing`

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –í—Å—Ç–∞–Ω–æ–≤–ª—é—î—Ç—å—Å—è `client_confirmed = TRUE`
- –°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `processing`
- –ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ `order_lifecycle`

---

## 3Ô∏è‚É£ –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è (Issue Card)

**UI:** `/manager/issue-card/{id}` - `IssueCardWorkspace.jsx`

**–¢–∞–±–ª–∏—Ü—è:** `issue_cards`

**–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª:**
- –ü–µ—Ä–µ–≥–ª—è–¥ —Ç–∞ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π
- –ß–µ–∫–ª–∏—Å—Ç –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—ó (—Å—Ç—Ä–µ–π—á—É–≤–∞–Ω–Ω—è, –º–∞—Ä–∫—É–≤–∞–Ω–Ω—è, —Ñ–æ—Ç–æ)
- –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–º–ø–ª–µ–∫—Ç—É–≤–∞–ª—å–Ω–∏–∫—ñ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ (–Ω–∞–∫–ª–∞–¥–Ω–∞, –∞–∫—Ç)

**Endpoint –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:** `PUT /api/issue-cards/{id}`

---

## 4Ô∏è‚É£ –í–∏–¥–∞—á–∞ –∫–ª—ñ—î–Ω—Ç—É

**–ü–µ—Ä–µ—Ö—ñ–¥:** `processing` ‚Üí `ready_for_issue` ‚Üí `issued`

**Endpoint:** `PUT /api/orders/{id}/status`

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ `issued`
- –§—ñ–∫—Å—É—î—Ç—å—Å—è `issued_at`, `issued_by`
- –¢–æ–≤–∞—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç—å –≤ —Å—Ç–∞—Ç—É—Å "–≤–∏–¥–∞–Ω–æ"
- –ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ `order_lifecycle`

---

## 5Ô∏è‚É£ –í –æ—Ä–µ–Ω–¥—ñ

**–°—Ç–∞—Ç—É—Å:** `on_rent` (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞—Ç–∏)

–ó–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `issued` —è–∫ –∞–∫—Ç–∏–≤–Ω–∏–π —Å—Ç–∞—Ç—É—Å –æ—Ä–µ–Ω–¥–∏.

---

## 6Ô∏è‚É£ –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è

**UI:** `/manager/return/{id}` - `ReturnOrderWorkspace.jsx`

### 6.1 –ü–æ–≤–Ω–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è

**Endpoint:** `POST /api/decor-orders/{id}/complete-return`

**–ü–µ—Ä–µ—Ö—ñ–¥:** `issued` ‚Üí `returned`

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –ü–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏
- –§—ñ–∫—Å—É—é—Ç—å—Å—è –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è (—è–∫—â–æ —î)
- –¢–æ–≤–∞—Ä–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –Ω–∞ —Å–∫–ª–∞–¥
- –†–æ–∑—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —à—Ç—Ä–∞—Ñ–∏ (late_fee, damage_fee)
- –ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ `fin_payments`
- –°—Ç–∞—Ç—É—Å ‚Üí `returned`

### 6.2 –ß–∞—Å—Ç–∫–æ–≤–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è

**–ú–æ–¥–∞–ª–∫–∞:** `PartialReturnModal.jsx`

**Endpoint:** `POST /api/partial-returns/order/{id}/process`

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:**
- –ö–ª—ñ—î–Ω—Ç –ø–æ–≤–µ—Ä–Ω—É–≤ –ù–ï –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏
- –ß–∞—Å—Ç–∏–Ω–∞ —Ç–æ–≤–∞—Ä—ñ–≤ –≤—Ç—Ä–∞—á–µ–Ω–∞/–ø–æ—à–∫–æ–¥–∂–µ–Ω–∞

**–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –Ω–µ–ø–æ–≤–µ—Ä–Ω–µ–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É –¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏:**

#### –í–∞—Ä—ñ–∞–Ω—Ç A: –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –æ—Ä–µ–Ω–¥–∏ (`action: 'extend'`)
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–ø–∏—Å –≤ `order_extensions`
- –°—Ç–∞—Ç—É—Å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Üí `partial_return`
- –©–æ–¥–Ω—è –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –¥–æ–±–æ–≤–∞ —Å—Ç–∞–≤–∫–∞
- –¢–æ–≤–∞—Ä –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è "–≤ –æ—Ä–µ–Ω–¥—ñ"

#### –í–∞—Ä—ñ–∞–Ω—Ç B: –ü–æ–≤–Ω–∞ –≤—Ç—Ä–∞—Ç–∞ (`action: 'loss'`)
- –°–ø–∏—Å—É—î—Ç—å—Å—è —Ç–æ–≤–∞—Ä –∑ `products.quantity`
- –ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ `product_damage_history`
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è `fin_payments` –∑ —Ç–∏–ø–æ–º `loss`
- –Ø–∫—â–æ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –≤—Ç—Ä–∞—á–µ–Ω—ñ ‚Üí —Å—Ç–∞—Ç—É—Å `returned`

---

## 7Ô∏è‚É£ –ü—Ä–∏–π–Ω—è—Ç—Ç—è —Ç–æ–≤–∞—Ä—ñ–≤ –∑ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è

**UI:** –¢–æ–π —Å–∞–º–∏–π `ReturnOrderWorkspace.jsx` –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å—ñ `partial_return`

**Endpoint:** `POST /api/partial-returns/order/{id}/accept-from-extension`

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
1. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä—É:
   - –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–µ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è (`order_extensions`)
   - –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –¥–Ω—ñ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–Ω—è (–≤—ñ–¥ `original_end_date` –¥–æ —Å—å–æ–≥–æ–¥–Ω—ñ)
   - –°—Ç–≤–æ—Ä—é—î `fin_payments` –∑ —Ç–∏–ø–æ–º `late`
   - –ó–∞–∫—Ä–∏–≤–∞—î –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è (`status = 'completed'`)
   - –ü–æ–≤–µ—Ä—Ç–∞—î —Ç–æ–≤–∞—Ä –Ω–∞ —Å–∫–ª–∞–¥

2. –Ø–∫—â–æ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç–æ:
   - –°—Ç–∞—Ç—É—Å ‚Üí `returned`
   - –ó–∞–ø–∏—Å—É—î—Ç—å—Å—è –≤ `order_lifecycle`

---

## 8Ô∏è‚É£ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è (Archive)

**Endpoint:** `POST /api/orders/{id}/archive`

**–ü–µ—Ä–µ—Ö—ñ–¥:** `returned` ‚Üí `completed` (–∞–±–æ –∞—Ä—Ö—ñ–≤–∞—Ü—ñ—è)

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- `is_archived = 1`
- –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–≤—É—î—Ç—å—Å—è –∑ –∞–∫—Ç–∏–≤–Ω–∏—Ö

---

## üìä –ö–ª—é—á–æ–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ

| –¢–∞–±–ª–∏—Ü—è | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|---------|-------------|
| `orders` | –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è |
| `order_items` | –¢–æ–≤–∞—Ä–∏ –≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ |
| `issue_cards` | –ö–∞—Ä—Ç–∫–∏ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—ó |
| `order_lifecycle` | –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω —Å—Ç–∞—Ç—É—Å—É |
| `order_extensions` | –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –æ—Ä–µ–Ω–¥–∏ (—á–∞—Å—Ç–∫–æ–≤–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è) |
| `partial_return_log` | –õ–æ–≥ —á–∞—Å—Ç–∫–æ–≤–∏—Ö –ø–æ–≤–µ—Ä–Ω–µ–Ω—å |
| `fin_payments` | –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó |
| `product_damage_history` | –Ü—Å—Ç–æ—Ä—ñ—è –ø–æ—à–∫–æ–¥–∂–µ–Ω—å |

---

## üîÑ API Endpoints Summary

### Orders
- `GET /api/orders` - –°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å
- `GET /api/orders/{id}` - –î–µ—Ç–∞–ª—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- `POST /api/orders` - –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- `PUT /api/orders/{id}` - –û–Ω–æ–≤–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- `PUT /api/orders/{id}/status` - –ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
- `DELETE /api/orders/{id}` - –í–∏–¥–∞–ª–∏—Ç–∏/—Å–∫–∞—Å—É–≤–∞—Ç–∏

### Issue Cards
- `GET /api/issue-cards/{id}` - –ö–∞—Ä—Ç–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—ó
- `PUT /api/issue-cards/{id}` - –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–∞—Ä—Ç–∫—É

### Returns
- `POST /api/decor-orders/{id}/complete-return` - –ó–∞–≤–µ—Ä—à–∏—Ç–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
- `PUT /api/decor-orders/{id}/return-progress` - –ó–±–µ—Ä–µ–≥—Ç–∏ –ø—Ä–æ–≥—Ä–µ—Å

### Partial Returns
- `GET /api/partial-returns/order/{id}/not-returned` - –ù–µ–ø–æ–≤–µ—Ä–Ω–µ–Ω—ñ —Ç–æ–≤–∞—Ä–∏
- `POST /api/partial-returns/order/{id}/process` - –û–±—Ä–æ–±–∏—Ç–∏ —á–∞—Å—Ç–∫–æ–≤–µ
- `GET /api/partial-returns/order/{id}/extensions` - –ü—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è –æ—Ä–µ–Ω–¥–∏
- `POST /api/partial-returns/order/{id}/accept-from-extension` - –ü—Ä–∏–π–Ω—è—Ç–∏ –∑ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω–Ω—è
- `GET /api/partial-returns/order/{id}/extension-summary` - –ü—ñ–¥—Å—É–º–æ–∫ –ø—Ä–æ–¥–æ–≤–∂–µ–Ω—å

---

## üí∞ –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ —Ç–∏–ø–∏ (fin_payments.payment_type)

| –¢–∏–ø | –û–ø–∏—Å |
|-----|------|
| `rent` | –û—Ä–µ–Ω–¥–∞ |
| `deposit` | –ó–∞—Å—Ç–∞–≤–∞ |
| `discount` | –ó–Ω–∏–∂–∫–∞ |
| `late` | –ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–Ω—è |
| `damage` | –ü–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è |
| `loss` | –ü–æ–≤–Ω–∞ –≤—Ç—Ä–∞—Ç–∞ |
| `prepayment` | –ü–µ—Ä–µ–¥–æ–ø–ª–∞—Ç–∞ |
| `refund` | –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ |

---

## üì± Frontend Routes

| Route | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|-------|-----------|-------------|
| `/manager/orders/{id}` | `NewOrderViewWorkspace` | –ü–µ—Ä–µ–≥–ª—è–¥/—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è |
| `/manager/issue-card/{id}` | `IssueCardWorkspace` | –ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è |
| `/manager/return/{id}` | `ReturnOrderWorkspace` | –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è |
| `/manager/finance` | `FinanceHub` | –§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∫–∞–±—ñ–Ω–µ—Ç |
