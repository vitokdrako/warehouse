# ‚úÖ –°—Ç–∞—Ç—É—Å–∏ –¢–æ–≤–∞—Ä—ñ–≤ - –Ø–∫ –ü—Ä–∞—Ü—é—î –°–∏—Å—Ç–µ–º–∞

**–î–∞—Ç–∞:** 02.12.2025

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–°—Ç–∞—Ç—É—Å–∏ —Ç–æ–≤–∞—Ä—ñ–≤ (–í –Ω–∞—è–≤–Ω., –†–µ–∑–µ—Ä–≤, –í –æ—Ä–µ–Ω–¥—ñ, –í —Ä–µ—Å—Ç–∞–≤—Ä.) –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∏—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö –≤–∏–¥–∞—á—ñ —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è.

## üîç –Ø–∫ –ø—Ä–∞—Ü—é—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤

### –î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö: `utils/availability_checker.py`

#### 1. –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å
```sql
SELECT quantity FROM products WHERE product_id = :product_id
```
**–î–∂–µ—Ä–µ–ª–æ:** —Ç–∞–±–ª–∏—Ü—è `products`, –ø–æ–ª–µ `quantity`

#### 2. –ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ (–ó–∞–º–æ—Ä–æ–∂–µ–Ω–æ)
```sql
SELECT SUM(oi.quantity) as reserved
FROM order_items oi
JOIN orders o ON oi.order_id = o.order_id
WHERE oi.product_id = :product_id
AND o.status IN ('processing', 'ready_for_issue', 'issued', 'on_rent')
AND o.rental_start_date <= :end_date 
AND o.rental_end_date >= :start_date
```

**–õ–æ–≥—ñ–∫–∞:**
- ‚úÖ **–ó–∞–º–æ—Ä–æ–∂–µ–Ω–æ:** —Å—Ç–∞—Ç—É—Å–∏ `processing`, `ready_for_issue`, `issued`, `on_rent`
- ‚úÖ **–†–æ–∑–º–æ—Ä–æ–∂–µ–Ω–æ:** —Å—Ç–∞—Ç—É—Å–∏ `returned`, `cancelled`, `completed`
- ‚úÖ **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–∞—Ç:** —Ç–æ–≤–∞—Ä –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∏–π —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –¥–∞—Ç–∏ –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è

#### 3. –í –æ—Ä–µ–Ω–¥—ñ –∑–∞—Ä–∞–∑
```sql
SELECT SUM(oi.quantity) as in_rent
FROM order_items oi
JOIN orders o ON oi.order_id = o.order_id
WHERE oi.product_id = :product_id
AND o.status IN ('issued', 'on_rent')
```

#### 4. –î–æ—Å—Ç—É–ø–Ω–æ
```
–î–æ—Å—Ç—É–ø–Ω–æ = –í—Å—å–æ–≥–æ - –ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ
```

---

## üìä –ü—Ä–∏–∫–ª–∞–¥ –∑ production

### –¢–æ–≤–∞—Ä: –ö–æ–ª–±–∞ (14 —Å–º, √ò-11)
**SKU:** VA2768

**–î–∞–Ω—ñ –∑ –ë–î:**
```
quantity (products): 119
```

**–ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:**
```sql
order_items WHERE product_id=2768 AND status IN ('processing', 'ready_for_issue', 'issued', 'on_rent')
‚Üí 2 —à—Ç –≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ OC-7040 (issued)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–í –Ω–∞—è–≤–Ω.: 117 (119 - 2)
–†–µ–∑–µ—Ä–≤: 2
–í –æ—Ä–µ–Ω–¥—ñ: 0 (issued –Ω–µ —Ä–∞—Ö—É—î—Ç—å—Å—è —è–∫ on_rent)
–í —Ä–µ—Å—Ç–∞–≤—Ä.: 0
```

---

## üîß –©–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ `issue_cards.py`

### –ë—É–ª–æ:
```python
# –°—Ç–∞—Ç—É—Å–∏ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª–∏—Å—è –∑ –ë–î
# Items –º—ñ—Å—Ç–∏–ª–∏ —Ç—ñ–ª—å–∫–∏ –¥–∞–Ω—ñ –∑ JSON
```

### –°—Ç–∞–ª–æ:
```python
# 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑ products
SELECT p.quantity FROM products p WHERE p.sku = :sku

# 2. –†–∞—Ö—É—î–º–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ
SELECT SUM(oi.quantity) FROM order_items oi
JOIN orders o ON oi.order_id = o.order_id
WHERE oi.product_id = :product_id
AND o.status IN ('processing', 'ready_for_issue', 'issued', 'on_rent')

# 3. –†–∞—Ö—É—î–º–æ –≤ –æ—Ä–µ–Ω–¥—ñ
SELECT SUM(oi.quantity) FROM order_items oi
JOIN orders o ON oi.order_id = o.order_id
WHERE oi.product_id = :product_id
AND o.status IN ('issued', 'on_rent')

# 4. –û–±—á–∏—Å–ª—é—î–º–æ –¥–æ—Å—Ç—É–ø–Ω–æ
available = total_quantity - reserved_qty
```

---

## üìã –°—Ç–∞—Ç—É—Å–∏ –ó–∞–º–æ–≤–ª–µ–Ω—å

### –ó–∞–º–æ—Ä–æ–∂—É—é—Ç—å —Ç–æ–≤–∞—Ä:
- `processing` - –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
- `ready_for_issue` - –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–¥–∞—á—ñ
- `issued` - –≤–∏–¥–∞–Ω–∏–π
- `on_rent` - –≤ –æ—Ä–µ–Ω–¥—ñ

### –†–æ–∑–º–æ—Ä–æ–∂—É—é—Ç—å —Ç–æ–≤–∞—Ä:
- `returned` - –ø–æ–≤–µ—Ä–Ω—É—Ç–æ
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- `cancelled` - —Å–∫–∞—Å–æ–≤–∞–Ω–æ

---

## üéØ –ü—Ä–∏–∫–ª–∞–¥ –ö–æ–Ω—Ñ–ª—ñ–∫—Ç—É

**–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è 1:**
- –¢–æ–≤–∞—Ä: –ì—ñ—Ä–ª—è–Ω–¥–∞ GR1
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å: 13 —à—Ç
- –î–∞—Ç–∏: 02.12 - 05.12
- –°—Ç–∞—Ç—É—Å: processing

**–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è 2:**
- –¢–æ–≤–∞—Ä: –ì—ñ—Ä–ª—è–Ω–¥–∞ GR1
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å: 10 —à—Ç
- –î–∞—Ç–∏: 04.12 - 07.12
- –°—Ç–∞—Ç—É—Å: issued

**–í—Å—å–æ–≥–æ –Ω–∞ —Å–∫–ª–∞–¥—ñ:** 23 —à—Ç

**–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫:**
```
–ó–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω–æ = 13 (–∑–∞–º.1) + 10 (–∑–∞–º.2) = 23 —à—Ç
–î–æ—Å—Ç—É–ø–Ω–æ = 23 - 23 = 0 —à—Ç

–î–∞—Ç–∏ –ø–µ—Ä–µ—Ç–∏–Ω–∞—é—Ç—å—Å—è:
  –ó–∞–º.1: [02.12 -------- 05.12]
  –ó–∞–º.2:         [04.12 -------- 07.12]
                    ^^^ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç
```

**–ù–æ–≤–∏–π –∑–∞–ø–∏—Ç –Ω–∞ 10 —à—Ç (04.12-06.12):**
```
‚ùå –ö–û–ù–§–õ–Ü–ö–¢ - –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ —Ç–æ–≤–∞—Ä—É!
–ó–∞–ø–∏—Ç–∞–Ω–æ: 10 —à—Ç
–î–æ—Å—Ç—É–ø–Ω–æ: 0 —à—Ç
–ë—Ä–∞–∫—É—î: 10 —à—Ç
```

---

## üìÅ –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏:

1. `/app/backend/routes/issue_cards.py`
   - –î–æ–¥–∞–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è `quantity` –∑ `products`
   - –î–æ–¥–∞–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ `reserved` –∑ `order_items`
   - –î–æ–¥–∞–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ `in_rent` –∑ `order_items`
   - –î–æ–¥–∞–Ω–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ `available = total - reserved`

2. `/app/backend/utils/availability_checker.py`
   - –í–∂–µ —ñ—Å–Ω—É–≤–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤)

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö –≤–∏–¥–∞—á—ñ —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è **–∞–∫—Ç—É–∞–ª—å–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏ —Ç–æ–≤–∞—Ä—ñ–≤**:

- ‚úÖ **–í –Ω–∞—è–≤–Ω.** - —Ä–∞—Ö—É—î—Ç—å—Å—è –∑ `products.quantity` –º—ñ–Ω—É—Å –∑–∞—Ä–µ–∑–µ—Ä–≤–æ–≤–∞–Ω—ñ
- ‚úÖ **–†–µ–∑–µ—Ä–≤** - —Å—É–º–∞ –∑ `order_items` –¥–ª—è –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å
- ‚úÖ **–í –æ—Ä–µ–Ω–¥—ñ** - —Å—É–º–∞ –∑ `order_items` –¥–ª—è –≤–∏–¥–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å
- ‚úÖ **–í —Ä–µ—Å—Ç–∞–≤—Ä.** - –ø–æ–∫–∏ 0 (TODO: —Ä–∞—Ö—É–≤–∞—Ç–∏ –∑ damages)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û
