# 💰 Додано Фінансовий Статус на Картках

**Дата:** 02.12.2025

## 🎯 Проблема
Реквізитор не бачив реальний фінансовий статус замовлення:
- ❌ Чи залишена застава?
- ❌ Чи оплачено рахунок?
- ❌ Які були платежі?

## ✅ Рішення

Створено новий компонент **FinanceStatusCard**, який показує:

### 📊 Що відображається:

#### 1. Застава
- ✅ **Залишено** - застава отримана від клієнта
- ⏳ **Очікується** - застава ще не залишена
- Сума застави (наприклад: ₴5,900)

#### 2. Оплата Рахунку
- ✅ **Оплачено** - рахунок за оренду сплачено
- ⏳ **Не оплачено** - очікується оплата
- Сума оренди (наприклад: ₴2,730)

#### 3. Історія Транзакцій
- 📋 Всі фінансові операції
- Типи: застава, оплата, повернення, списання
- Статуси: завершено ✓ або очікується ⏳

#### 4. Загальний Статус
- ✅ **Всі фінансові питання вирішені** - можна видавати/приймати
- ⚠️ **Очікується оплата/застава** - є незакриті питання

---

## 📍 Де відображається?

### 1. Картка Видачі (`/issue/:id`)
Реквізитор бачить **ДО видачі замовлення**:
```
┌─────────────────────────────────┐
│ 💰 Фінансовий статус            │
├─────────────────────────────────┤
│ Застава:        ₴5,900 ✅       │
│ Рахунок:        ₴2,730 ⏳       │
│                                 │
│ ⚠️ Очікується оплата рахунку    │
└─────────────────────────────────┘
```

**Рішення:** Якщо рахунок не оплачено - попередити клієнта або не видавати до оплати.

### 2. Картка Повернення (`/return/:id`)
Реквізитор бачить **ПРИ поверненні**:
```
┌─────────────────────────────────┐
│ 💰 Фінансовий статус            │
├─────────────────────────────────┤
│ Застава:        ₴5,900 ✅       │
│ Рахунок:        ₴2,730 ✅       │
│                                 │
│ ✅ Всі фінансові питання        │
│    вирішені                     │
└─────────────────────────────────┘
```

**Рішення:** Можна повертати заставу без обмежень.

---

## 🔍 Приклади Статусів

### Сценарій 1: Ідеально ✅
```
Застава: ₴5,900 ✅ Залишено
Рахунок: ₴2,730 ✅ Оплачено

→ Всі фінансові питання вирішені
```

### Сценарій 2: Застава є, рахунок ні ⚠️
```
Застава: ₴5,900 ✅ Залишено
Рахунок: ₴2,730 ⏳ Не оплачено

→ Очікується оплата рахунку
```

### Сценарій 3: Нічого не оплачено ⚠️
```
Застава: ₴5,900 ⏳ Очікується
Рахунок: ₴2,730 ⏳ Не оплачено

→ Очікується застава та оплата
```

---

## 🛠️ Технічні Деталі

### API Endpoint
```
GET /api/finance/transactions?order_id={orderId}
```

**Відповідь:**
```json
[
  {
    "type": "deposit_hold",
    "amount": 5900.0,
    "currency": "UAH",
    "status": "completed"
  },
  {
    "type": "rent_accrual",
    "amount": 2730.0,
    "currency": "UAH",
    "status": "pending"
  }
]
```

### Типи Транзакцій
- `deposit_expected` - Застава очікується
- `deposit_hold` - Застава отримана ✓
- `deposit_release` - Застава повернута
- `deposit_writeoff` - Списано з застави
- `rent_accrual` - Оренда нараховано
- `payment` - Оплата рахунку ✓
- `refund` - Повернення коштів

### Статуси
- `completed` ✓ - Транзакція завершена
- `pending` ⏳ - Очікується
- `failed` ❌ - Помилка

---

## 📦 Створені Файли

1. `/app/frontend/src/components/FinanceStatusCard.jsx` - новий компонент
2. `/app/frontend/src/pages/IssueCard.jsx` - оновлено (додано FinanceStatusCard)
3. `/app/frontend/src/pages/ReturnOrderClean.jsx` - оновлено (додано FinanceStatusCard)

---

## ✅ Результат

Тепер **реквізитор бачить фінансовий статус** на кожній картці:
- 🎯 Зрозуміло чи можна видавати замовлення
- 💰 Видно чи оплачено та залишено заставу
- 📋 Повна історія транзакцій для прозорості
- ⚠️ Попередження якщо є незакриті питання

**Статус:** ✅ ГОТОВО ДО ТЕСТУВАННЯ
