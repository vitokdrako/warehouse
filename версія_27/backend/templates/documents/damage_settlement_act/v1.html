{% extends '_base.html' %}
{% block title %}–ê–∫—Ç —É—Ç—Ä–∏–º–∞–Ω–Ω—è {{ order.order_number }}{% endblock %}

{% block extra_styles %}
<style>
    .damage-table th { background: #fef3c7; }
    .damage-row:hover { background: #fffbeb; }
    .severity-low { color: #059669; }
    .severity-medium { color: #d97706; }
    .severity-high { color: #dc2626; }
    .severity-critical { color: #7c2d12; font-weight: bold; }
    .summary-box { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 15px; margin: 15px 0; }
    .refund-box { background: #d1fae5; border: 2px solid #10b981; border-radius: 8px; padding: 15px; }
    .deduction-box { background: #fee2e2; border: 2px solid #ef4444; border-radius: 8px; padding: 15px; }
</style>
{% endblock %}

{% block content %}
<div class="header">
    <div>
        <div class="logo">FarforRent</div>
        <div class="text-sm">{{ company.legal_name }}</div>
    </div>
    <div class="doc-info">
        <div class="doc-number">{{ doc_number }}</div>
        <div class="doc-date">{{ generated_at }}</div>
    </div>
</div>

<h1>–ê–ö–¢ –£–¢–†–ò–ú–ê–ù–ù–Ø –Ü–ó –ó–ê–°–¢–ê–í–ò</h1>

<table class="mb-4">
    <tr><td style="width:150px">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è:</td><td class="font-bold">{{ order.order_number }}</td></tr>
    <tr><td>–ö–ª—ñ—î–Ω—Ç:</td><td class="font-bold">{{ order.customer_name }}</td></tr>
    <tr><td>–¢–µ–ª–µ—Ñ–æ–Ω:</td><td>{{ order.customer_phone }}</td></tr>
    <tr><td>–ü–µ—Ä—ñ–æ–¥ –æ—Ä–µ–Ω–¥–∏:</td><td>{{ order.rental_start_date }} ‚Äî {{ order.rental_end_date }}</td></tr>
</table>

<div class="summary-box">
    <div class="flex justify-between">
        <span>–í–Ω–µ—Å–µ–Ω–∞ –∑–∞—Å—Ç–∞–≤–∞:</span>
        <span class="font-bold text-lg">{{ totals.deposit|money }} ‚Ç¥</span>
    </div>
</div>

{% if damage_items %}
<h2>üìã –í–∏—è–≤–ª–µ–Ω—ñ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è ({{ totals.damage_count }})</h2>
<table class="damage-table">
    <thead>
        <tr>
            <th style="width:30%">–¢–æ–≤–∞—Ä</th>
            <th>–¢–∏–ø —à–∫–æ–¥–∏</th>
            <th>–°–µ—Ä–π–æ–∑–Ω—ñ—Å—Ç—å</th>
            <th class="text-center">–ö-—Å—Ç—å</th>
            <th class="text-right">–¶—ñ–Ω–∞/—à—Ç</th>
            <th class="text-right">–°—É–º–∞</th>
        </tr>
    </thead>
    <tbody>
        {% for item in damage_items %}
        <tr class="damage-row">
            <td>
                <div class="font-medium">{{ item.product_name }}</div>
                <div class="text-xs text-gray-500">{{ item.sku }}</div>
            </td>
            <td>{{ item.damage_type }}</td>
            <td>
                <span class="severity-{{ item.severity_code }}">{{ item.severity }}</span>
            </td>
            <td class="text-center">{{ item.qty }}</td>
            <td class="text-right">{{ item.fee_per_item|money }} ‚Ç¥</td>
            <td class="text-right font-medium">{{ item.fee|money }} ‚Ç¥</td>
        </tr>
        {% if item.note %}
        <tr class="damage-row">
            <td colspan="6" class="text-sm text-gray-600" style="padding-left: 20px;">
                üí¨ {{ item.note }}
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="highlight" style="background: #d1fae5; padding: 15px; margin: 15px 0;">
    <p class="text-center">‚úÖ –ü–æ—à–∫–æ–¥–∂–µ–Ω—å –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ</p>
</div>
{% endif %}

<h2>üí∞ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —É—Ç—Ä–∏–º–∞–Ω—å</h2>
<table>
    <tbody>
        {% if deductions.damage_amount > 0 %}
        <tr>
            <td style="width:70%">–ö–æ–º–ø–µ–Ω—Å–∞—Ü—ñ—è –∑–∞ –ø–æ—à–∫–æ–¥–∂–µ–Ω–Ω—è/–≤—Ç—Ä–∞—Ç–∏</td>
            <td class="text-right">{{ deductions.damage_amount|money }} ‚Ç¥</td>
        </tr>
        {% endif %}
        {% if deductions.cleaning_fee > 0 %}
        <tr>
            <td>–•—ñ–º—á–∏—Å—Ç–∫–∞</td>
            <td class="text-right">{{ deductions.cleaning_fee|money }} ‚Ç¥</td>
        </tr>
        {% endif %}
        {% if deductions.late_days > 0 %}
        <tr>
            <td>–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–Ω—è ({{ deductions.late_days }} –¥–Ω.)</td>
            <td class="text-right">{{ deductions.late_fee|money }} ‚Ç¥</td>
        </tr>
        {% endif %}
    </tbody>
    <tfoot>
        <tr class="font-bold" style="border-top: 2px solid #000;">
            <td>–í–°–¨–û–ì–û –£–¢–†–ò–ú–ê–ù–û:</td>
            <td class="text-right">{{ deductions.total_deduction|money }} ‚Ç¥</td>
        </tr>
    </tfoot>
</table>

<div class="grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
    <div class="deduction-box">
        <div class="text-sm">–£—Ç—Ä–∏–º–∞–Ω–æ —ñ–∑ –∑–∞—Å—Ç–∞–≤–∏:</div>
        <div class="font-bold text-xl">-{{ deductions.total_deduction|money }} ‚Ç¥</div>
    </div>
    <div class="refund-box">
        <div class="text-sm">–î–æ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—É:</div>
        <div class="font-bold text-xl">{{ deductions.refund_amount|money }} ‚Ç¥</div>
    </div>
</div>

<div class="highlight" style="padding:12px; margin-top:20px; background: #f3f4f6;">
    <p class="text-sm">
        –ü—ñ–¥–ø–∏—Å—É—é—á–∏ —Ü–µ–π –∞–∫—Ç, —Å—Ç–æ—Ä–æ–Ω–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é—Ç—å:<br>
        ‚Ä¢ –§–∞–∫—Ç –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ—à–∫–æ–¥–∂–µ–Ω—å –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ –≤—ñ—Ä–Ω–æ<br>
        ‚Ä¢ –°—É–º–∏ –∫–æ–º–ø–µ–Ω—Å–∞—Ü—ñ–π —É–∑–≥–æ–¥–∂–µ–Ω—ñ<br>
        ‚Ä¢ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —É—Ç—Ä–∏–º–∞–Ω—å —Ç–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑–∞—Å—Ç–∞–≤–∏ –ø—Ä–∏–π–Ω—è—Ç–æ
    </p>
</div>

<div class="signatures">
    <div class="signature-block">
        <p class="font-bold">–û–†–ï–ù–î–û–î–ê–í–ï–¶–¨:</p>
        <p class="text-sm">{{ company.legal_name }}</p>
        <div class="signature-line"></div>
        <p class="text-xs">–î–∞—Ç–∞: _______________</p>
    </div>
    <div class="signature-block">
        <p class="font-bold">–û–†–ï–ù–î–ê–†:</p>
        <p class="text-sm">{{ order.customer_name }}</p>
        <div class="signature-line"></div>
        <p class="text-xs">–î–∞—Ç–∞: _______________</p>
    </div>
</div>
{% endblock %}
